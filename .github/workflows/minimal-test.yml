name: âœ… Minimal Test (Always Passes)

# This workflow is designed to always pass and help diagnose issues
# Run this first to ensure GitHub Actions is working properly

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  hello-world:
    name: ðŸ‘‹ Hello World Test
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ðŸ‘‹ Say hello
      run: |
        echo "ðŸŽ‰ Hello from ALN Programming Language!"
        echo "ðŸ• Current time: $(date)"
        echo "ðŸ–¥ï¸ Running on: $(uname -a)"
        echo "ðŸ“ Current directory: $(pwd)"
        echo "ðŸ‘¤ Running as: $(whoami)"

    - name: âœ… Basic commands test
      run: |
        echo "âœ… Testing basic commands..."
        
        # Test common commands that should always be available
        echo "Git version: $(git --version)"
        echo "Curl version: $(curl --version | head -1)"
        echo "Python version: $(python3 --version)"
        
        # Simple math test
        RESULT=$((2 + 2))
        if [[ $RESULT -eq 4 ]]; then
          echo "âœ… Math test passed: 2 + 2 = $RESULT"
        else
          echo "âŒ Math test failed: Expected 4, got $RESULT"
          exit 1
        fi

    - name: ðŸ“¦ Minimal checkout test
      uses: actions/checkout@v4
      with:
        fetch-depth: 1

    - name: ðŸ“‚ List files
      run: |
        echo "ðŸ“‚ Repository contents:"
        ls -la
        echo ""
        echo "ðŸ“Š File count: $(find . -type f | wc -l)"
        echo "ðŸ“ Directory count: $(find . -type d | wc -l)"

  environment-info:
    name: ðŸŒ Environment Information
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ðŸŒ Display environment
      run: |
        echo "ðŸŒ GitHub Actions Environment Information:"
        echo ""
        echo "ðŸ“‹ GitHub Context:"
        echo "Repository: $GITHUB_REPOSITORY"
        echo "Workflow: $GITHUB_WORKFLOW"
        echo "Action: $GITHUB_ACTION"
        echo "Actor: $GITHUB_ACTOR"
        echo "Event: $GITHUB_EVENT_NAME"
        echo "Ref: $GITHUB_REF"
        echo "SHA: $GITHUB_SHA"
        echo "Run ID: $GITHUB_RUN_ID"
        echo "Run Number: $GITHUB_RUN_NUMBER"
        echo ""
        echo "ðŸ–¥ï¸ System Information:"
        echo "OS: $RUNNER_OS"
        echo "Architecture: $RUNNER_ARCH"
        echo "Workspace: $GITHUB_WORKSPACE"
        echo "Home: $HOME"
        echo ""
        echo "ðŸ”§ Available Tools:"
        echo "Node.js: $(node --version 2>/dev/null || echo 'Not available')"
        echo "NPM: $(npm --version 2>/dev/null || echo 'Not available')"
        echo "Docker: $(docker --version 2>/dev/null || echo 'Not available')"
        echo "Make: $(make --version 2>/dev/null | head -1 || echo 'Not available')"

  json-test:
    name: ðŸ“‹ JSON Processing Test
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ðŸ“‹ Create and process JSON
      run: |
        echo "ðŸ“‹ JSON Processing Test:"
        
        # Create test JSON
        cat > test.json << 'EOF'
        {
          "name": "ALN Programming Language",
          "version": "12.0.0",
          "status": "active",
          "features": [
            "Cross-platform",
            "AI-native",
            "Quantum-ready"
          ],
          "timestamp": "2025-01-01T00:00:00Z"
        }
        EOF
        
        # Validate JSON
        if python3 -m json.tool test.json > /dev/null 2>&1; then
          echo "âœ… JSON validation passed"
        else
          echo "âŒ JSON validation failed"
          exit 1
        fi
        
        # Extract values
        NAME=$(python3 -c "import json; f=open('test.json'); data=json.load(f); print(data['name'])")
        VERSION=$(python3 -c "import json; f=open('test.json'); data=json.load(f); print(data['version'])")
        
        echo "ðŸ“¦ Extracted name: $NAME"
        echo "ðŸ·ï¸ Extracted version: $VERSION"
        
        # Cleanup
        rm -f test.json

  network-test:
    name: ðŸŒ Network Connectivity Test
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: ðŸŒ Test network connectivity
      run: |
        echo "ðŸŒ Network Connectivity Test:"
        
        # Test basic connectivity to GitHub
        if curl -s --connect-timeout 10 https://github.com > /dev/null; then
          echo "âœ… GitHub.com: Reachable"
        else
          echo "âŒ GitHub.com: Not reachable"
        fi
        
        # Test GitHub API
        if curl -s --connect-timeout 10 https://api.github.com > /dev/null; then
          echo "âœ… GitHub API: Reachable"
        else
          echo "âŒ GitHub API: Not reachable"
        fi
        
        # Test a simple HTTP request
        echo "ðŸ” Testing HTTP request to httpbin.org..."
        RESPONSE=$(curl -s --connect-timeout 10 https://httpbin.org/json || echo "failed")
        
        if [[ "$RESPONSE" != "failed" ]]; then
          echo "âœ… HTTP request test passed"
        else
          echo "âš ï¸ HTTP request test failed (but this won't fail the job)"
        fi

  docker-test:
    name: ðŸ³ Docker Test
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ðŸ³ Test Docker availability
      run: |
        echo "ðŸ³ Docker Availability Test:"
        
        # Check if Docker is available
        if command -v docker > /dev/null 2>&1; then
          echo "âœ… Docker command available"
          echo "Docker version: $(docker --version)"
          
          # Check if Docker daemon is running
          if docker info > /dev/null 2>&1; then
            echo "âœ… Docker daemon is running"
            
            # Test simple container run
            echo "ðŸ§ª Testing simple container..."
            if docker run --rm hello-world > /dev/null 2>&1; then
              echo "âœ… Docker container test passed"
            else
              echo "âš ï¸ Docker container test failed (non-critical)"
            fi
          else
            echo "âš ï¸ Docker daemon not accessible (this is expected in some runners)"
          fi
        else
          echo "âŒ Docker command not available"
        fi

  permissions-test:
    name: ðŸ” Permissions Test
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    permissions:
      contents: read
      actions: read
    
    steps:
    - name: ðŸ” Test basic permissions
      run: |
        echo "ðŸ” Basic Permissions Test:"
        
        # Test file operations in workspace
        echo "ðŸ“ Testing file operations..."
        
        # Create a test file
        echo "test content" > test-file.txt
        if [[ -f "test-file.txt" ]]; then
          echo "âœ… File creation: Success"
        else
          echo "âŒ File creation: Failed"
          exit 1
        fi
        
        # Read the file
        CONTENT=$(cat test-file.txt)
        if [[ "$CONTENT" == "test content" ]]; then
          echo "âœ… File reading: Success"
        else
          echo "âŒ File reading: Failed"
          exit 1
        fi
        
        # Delete the file
        rm test-file.txt
        if [[ ! -f "test-file.txt" ]]; then
          echo "âœ… File deletion: Success"
        else
          echo "âŒ File deletion: Failed"
          exit 1
        fi

    - name: ðŸ”‘ Test GitHub token
      run: |
        echo "ðŸ”‘ GitHub Token Test:"
        
        # Test if GITHUB_TOKEN is available (it should be)
        if [[ -n "${{ secrets.GITHUB_TOKEN }}" ]]; then
          echo "âœ… GITHUB_TOKEN is available"
          
          # Test basic API call
          if curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                  "https://api.github.com/repos/${{ github.repository }}" > /dev/null; then
            echo "âœ… GitHub API authentication: Success"
          else
            echo "âŒ GitHub API authentication: Failed"
          fi
        else
          echo "âŒ GITHUB_TOKEN is not available"
          exit 1
        fi

  summary:
    name: ðŸ“Š Test Summary
    runs-on: ubuntu-latest
    needs: [hello-world, environment-info, json-test, network-test, docker-test, permissions-test]
    if: always()
    timeout-minutes: 5
    
    steps:
    - name: ðŸ“Š Generate summary
      run: |
        echo "ðŸ“Š Minimal Test Workflow Summary"
        echo "=================================="
        echo ""
        echo "Job Results:"
        echo "Hello World: ${{ needs.hello-world.result }}"
        echo "Environment Info: ${{ needs.environment-info.result }}"
        echo "JSON Test: ${{ needs.json-test.result }}"
        echo "Network Test: ${{ needs.network-test.result }}"
        echo "Docker Test: ${{ needs.docker-test.result }}"
        echo "Permissions Test: ${{ needs.permissions-test.result }}"
        echo ""
        
        # Count successful jobs
        SUCCESSFUL=0
        TOTAL=6
        
        [[ "${{ needs.hello-world.result }}" == "success" ]] && ((SUCCESSFUL++))
        [[ "${{ needs.environment-info.result }}" == "success" ]] && ((SUCCESSFUL++))
        [[ "${{ needs.json-test.result }}" == "success" ]] && ((SUCCESSFUL++))
        [[ "${{ needs.network-test.result }}" == "success" ]] && ((SUCCESSFUL++))
        [[ "${{ needs.docker-test.result }}" == "success" ]] && ((SUCCESSFUL++))
        [[ "${{ needs.permissions-test.result }}" == "success" ]] && ((SUCCESSFUL++))
        
        PERCENTAGE=$((SUCCESSFUL * 100 / TOTAL))
        
        echo "Success Rate: $SUCCESSFUL/$TOTAL ($PERCENTAGE%)"
        echo ""
        
        if [[ $SUCCESSFUL -eq $TOTAL ]]; then
          echo "ðŸŽ‰ All tests passed! GitHub Actions is working properly."
          echo ""
          echo "âœ… Your repository is ready for more complex workflows."
          echo "âœ… Basic functionality is confirmed working."
          echo "âœ… Network connectivity is good."
          echo "âœ… Permissions are properly configured."
        elif [[ $SUCCESSFUL -ge 4 ]]; then
          echo "âš ï¸ Most tests passed, but some had issues."
          echo "This is likely not a critical problem."
          echo ""
          echo "ðŸ’¡ Check the failed job logs for specific details."
        else
          echo "âŒ Multiple tests failed."
          echo "There may be a fundamental issue with the workflow setup."
          echo ""
          echo "ðŸ” Recommended actions:"
          echo "1. Check repository permissions"
          echo "2. Verify workflow file syntax"
          echo "3. Review GitHub Actions settings"
        fi
        echo ""
        echo "ðŸš€ Next steps:"
        echo "1. If this workflow passes, your GitHub Actions setup is working"
        echo "2. You can now run more complex workflows with confidence"
        echo "3. Check other workflow files for syntax errors if they're still failing"

    - name: ðŸ“ Create step summary
      run: |
        cat >> $GITHUB_STEP_SUMMARY << 'EOF'
        ## ðŸŽ¯ Minimal Test Results
        
        This workflow tests basic GitHub Actions functionality.
        
        | Test | Result | Status |
        |------|---------|---------|
        | Hello World | ${{ needs.hello-world.result }} | ${{ needs.hello-world.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        | Environment Info | ${{ needs.environment-info.result }} | ${{ needs.environment-info.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        | JSON Processing | ${{ needs.json-test.result }} | ${{ needs.json-test.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        | Network Connectivity | ${{ needs.network-test.result }} | ${{ needs.network-test.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        | Docker Test | ${{ needs.docker-test.result }} | ${{ needs.docker-test.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        | Permissions Test | ${{ needs.permissions-test.result }} | ${{ needs.permissions-test.result == 'success' && 'âœ… Pass' || 'âŒ Fail' }} |
        
        ### ðŸ’¡ What This Means
        
        - **All Green**: Your GitHub Actions setup is working perfectly
        - **Mostly Green**: Minor issues that probably won't affect other workflows  
        - **Multiple Red**: There may be fundamental issues to address
        
        ### ðŸ”§ If Tests Are Failing
        
        1. Check the individual job logs above for specific error messages
        2. Verify your repository has the correct permissions
        3. Ensure workflow files have valid YAML syntax
        4. Try re-running the workflow (sometimes transient issues occur)
        EOF
